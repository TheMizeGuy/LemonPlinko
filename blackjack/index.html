<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lemon Blackjack</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #0a0e1a 0%, #151c2c 50%, #0d1320 100%);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: #fff;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 24px;
    }

    .panel {
      background: linear-gradient(180deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px);
    }

    .left-panel {
      width: 320px;
    }

    .right-panel {
      width: 280px;
      max-height: 750px;
      overflow: hidden;
    }

    .balance-display {
      background: linear-gradient(135deg, rgba(250, 204, 21, 0.15) 0%, rgba(234, 179, 8, 0.1) 100%);
      border-radius: 14px;
      padding: 20px;
      margin-bottom: 24px;
      border: 1px solid rgba(250, 204, 21, 0.2);
    }

    .balance-label {
      font-size: 12px;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .balance-value {
      font-size: 32px;
      font-weight: 700;
      color: #facc15;
      font-family: 'JetBrains Mono', monospace;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-label {
      font-size: 13px;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: block;
      margin-bottom: 10px;
    }

    .bet-input {
      width: 100%;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 14px;
      color: #fff;
      font-size: 18px;
      font-family: 'JetBrains Mono', monospace;
      outline: none;
    }

    .bet-input:focus {
      border-color: rgba(250, 204, 21, 0.5);
    }

    .bet-input:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-group {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .btn-small {
      flex: 1;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #9ca3af;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-small:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.1);
    }

    .btn-small:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-play {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #facc15 0%, #eab308 100%);
      border: none;
      border-radius: 14px;
      color: #000;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 20px rgba(250, 204, 21, 0.4);
      margin-bottom: 12px;
    }

    .btn-play:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 6px 25px rgba(250, 204, 21, 0.5);
    }

    .btn-play:disabled {
      background: rgba(255, 255, 255, 0.1);
      color: #6b7280;
      box-shadow: none;
      cursor: not-allowed;
      transform: none;
    }

    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 16px;
    }

    .btn-action {
      padding: 16px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }

    .btn-hit {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.3) 0%, rgba(22, 163, 74, 0.2) 100%);
      border-color: #22c55e;
      color: #22c55e;
    }

    .btn-hit:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.5) 0%, rgba(22, 163, 74, 0.4) 100%);
    }

    .btn-stand {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(220, 38, 38, 0.2) 100%);
      border-color: #ef4444;
      color: #ef4444;
    }

    .btn-stand:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.5) 0%, rgba(220, 38, 38, 0.4) 100%);
    }

    .btn-double {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(37, 99, 235, 0.2) 100%);
      border-color: #3b82f6;
      color: #3b82f6;
    }

    .btn-double:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.5) 0%, rgba(37, 99, 235, 0.4) 100%);
    }

    .btn-split {
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.3) 0%, rgba(139, 92, 246, 0.2) 100%);
      border-color: #a855f7;
      color: #a855f7;
    }

    .btn-split:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.5) 0%, rgba(139, 92, 246, 0.4) 100%);
    }

    .btn-action:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      transform: none;
    }

    .result-box {
      margin-top: 20px;
      padding: 14px;
      border-radius: 12px;
    }

    .result-box.win {
      background: rgba(250, 204, 21, 0.15);
      border: 1px solid rgba(250, 204, 21, 0.3);
    }

    .result-box.loss {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .result-box.push {
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .result-label {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    .result-value {
      font-size: 22px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .result-value.win {
      color: #facc15;
    }

    .result-value.loss {
      color: #ef4444;
    }

    .result-value.push {
      color: #3b82f6;
    }

    .profit-box {
      margin-top: 14px;
      padding: 14px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .game-board {
      background: linear-gradient(180deg, rgba(30, 41, 59, 0.6) 0%, rgba(15, 23, 42, 0.8) 100%);
      border-radius: 24px;
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      min-width: 600px;
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .game-title {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, #facc15 0%, #eab308 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .made-by {
      font-size: 14px;
      font-weight: 400;
      color: #9ca3af;
      margin-left: 8px;
      font-style: italic;
      -webkit-text-fill-color: #9ca3af;
    }

    .game-badges {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .badge {
      font-size: 13px;
      padding: 8px 14px;
      border-radius: 20px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .badge-decks {
      background: rgba(59, 130, 246, 0.2);
      color: #60a5fa;
    }

    .badge-bet {
      background: rgba(250, 204, 21, 0.2);
      color: #facc15;
    }

    .table-felt {
      background: linear-gradient(180deg, #1a472a 0%, #15803d 50%, #166534 100%);
      border-radius: 20px;
      padding: 30px;
      min-height: 400px;
      position: relative;
      border: 8px solid #854d0e;
      box-shadow: inset 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .dealer-area {
      text-align: center;
      margin-bottom: 40px;
    }

    .player-area {
      text-align: center;
    }

    .hand-label {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 12px;
    }

    .hand-value {
      display: inline-block;
      background: rgba(0, 0, 0, 0.5);
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 20px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      color: #fff;
      margin-bottom: 16px;
    }

    .hand-value.blackjack {
      background: linear-gradient(135deg, #facc15 0%, #eab308 100%);
      color: #000;
    }

    .hand-value.bust {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: #fff;
    }

    .cards-container {
      display: flex;
      justify-content: center;
      gap: 12px;
      min-height: 120px;
      flex-wrap: wrap;
    }

    .card {
      width: 80px;
      height: 112px;
      background: linear-gradient(180deg, #fff 0%, #f3f4f6 100%);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 8px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      position: relative;
      animation: dealCard 0.3s ease-out;
      transform-origin: center;
    }

    @keyframes dealCard {
      0% {
        transform: translateY(-50px) rotate(-10deg) scale(0.8);
        opacity: 0;
      }
      100% {
        transform: translateY(0) rotate(0) scale(1);
        opacity: 1;
      }
    }

    .card.face-down {
      background: linear-gradient(135deg, #1e40af 0%, #1d4ed8 50%, #2563eb 100%);
      border: 3px solid #3b82f6;
    }

    .card.face-down::before {
      content: 'üçã';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 32px;
    }

    .card.face-down::after {
      content: '';
      position: absolute;
      inset: 8px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
    }

    .card-corner {
      display: flex;
      flex-direction: column;
      align-items: center;
      line-height: 1;
    }

    .card-corner.bottom {
      align-self: flex-end;
      transform: rotate(180deg);
    }

    .card-rank {
      font-size: 18px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .card-suit {
      font-size: 16px;
    }

    .card.red .card-rank,
    .card.red .card-suit {
      color: #dc2626;
    }

    .card.black .card-rank,
    .card.black .card-suit {
      color: #1f2937;
    }

    .card-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 36px;
    }

    .game-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      padding: 20px 40px;
      border-radius: 16px;
      font-size: 28px;
      font-weight: 800;
      text-align: center;
      z-index: 10;
      animation: messagePopup 0.4s ease-out;
    }

    @keyframes messagePopup {
      0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
      }
      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }

    .game-message.win {
      border: 3px solid #facc15;
      color: #facc15;
    }

    .game-message.lose {
      border: 3px solid #ef4444;
      color: #ef4444;
    }

    .game-message.push {
      border: 3px solid #3b82f6;
      color: #3b82f6;
    }

    .game-message.blackjack {
      border: 3px solid #facc15;
      background: linear-gradient(135deg, rgba(250, 204, 21, 0.2) 0%, rgba(0, 0, 0, 0.9) 100%);
      color: #facc15;
    }

    .stats-bar {
      display: flex;
      justify-content: space-around;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      padding: 16px 20px;
      margin-top: 20px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-label {
      font-size: 11px;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 20px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      color: #fff;
    }

    .history-title {
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 600px;
      overflow-y: auto;
    }

    .history-empty {
      color: #6b7280;
      font-size: 14px;
      text-align: center;
      padding: 50px 0;
    }

    .history-item {
      padding: 12px 14px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .history-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .history-result {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
    }

    .history-result.win {
      background: rgba(250, 204, 21, 0.2);
      color: #facc15;
    }

    .history-result.lose {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .history-result.push {
      background: rgba(59, 130, 246, 0.2);
      color: #3b82f6;
    }

    .history-result.blackjack {
      background: linear-gradient(135deg, rgba(250, 204, 21, 0.3) 0%, rgba(234, 179, 8, 0.2) 100%);
      color: #facc15;
    }

    .history-profit {
      font-size: 14px;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
    }

    .history-profit.win {
      color: #facc15;
    }

    .history-profit.loss {
      color: #ef4444;
    }

    .history-hands {
      font-size: 12px;
      color: #9ca3af;
      font-family: 'JetBrains Mono', monospace;
    }

    .section {
      margin-bottom: 20px;
    }

    .insurance-prompt {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.95);
      padding: 24px 32px;
      border-radius: 16px;
      border: 2px solid #facc15;
      text-align: center;
      z-index: 20;
    }

    .insurance-prompt h3 {
      font-size: 20px;
      color: #facc15;
      margin-bottom: 12px;
    }

    .insurance-prompt p {
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 16px;
    }

    .insurance-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .insurance-btn {
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .insurance-yes {
      background: linear-gradient(135deg, #facc15 0%, #eab308 100%);
      border: none;
      color: #000;
    }

    .insurance-no {
      background: transparent;
      border: 2px solid #6b7280;
      color: #9ca3af;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .lemon-icon {
      font-size: 20px;
    }

    @media (max-width: 1100px) {
      body {
        flex-direction: column;
        align-items: center;
      }
      
      .left-panel, .right-panel {
        width: 100%;
        max-width: 500px;
      }

      .game-board {
        min-width: auto;
        width: 100%;
        max-width: 600px;
      }
    }
  </style>
</head>
<body>
  <!-- Left Panel - Controls -->
  <div class="panel left-panel">
    <!-- Balance Display -->
    <div class="balance-display">
      <div class="balance-label">
        <span class="lemon-icon">üçã</span> Balance
      </div>
      <div class="balance-value">
        <span id="balanceValue">1000.00</span>
        <span style="font-size: 16px; font-weight: 500;">Lemons</span>
      </div>
    </div>

    <!-- Bet Amount -->
    <div class="section">
      <label class="section-label">Bet Amount (Lemons)</label>
      <input type="number" id="betInput" class="bet-input" value="10" min="1">
      <div class="btn-group">
        <button class="btn-small" id="betHalf" onclick="adjustBet(0.5)">¬Ωx</button>
        <button class="btn-small" id="betDouble" onclick="adjustBet(2)">2x</button>
        <button class="btn-small" id="betMax" onclick="setBetMax()">MAX</button>
      </div>
    </div>

    <!-- Deal Button -->
    <button class="btn-play" id="dealBtn" onclick="startGame()">
      üÉè Deal Cards
    </button>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn-action btn-hit" id="hitBtn" onclick="hit()" disabled>
        Hit
      </button>
      <button class="btn-action btn-stand" id="standBtn" onclick="stand()" disabled>
        Stand
      </button>
      <button class="btn-action btn-double" id="doubleBtn" onclick="doubleDown()" disabled>
        Double
      </button>
      <button class="btn-action btn-split" id="splitBtn" onclick="split()" disabled>
        Split
      </button>
    </div>

    <!-- Last Result -->
    <div class="result-box win" id="lastResult" style="display: none;">
      <div class="result-label">Last Result</div>
      <div class="result-value win" id="lastResultValue"></div>
    </div>

    <!-- Total Profit -->
    <div class="profit-box">
      <div class="result-label">Session Profit</div>
      <div class="result-value win" id="profitValue" style="font-size: 18px;">+0.00 üçã</div>
    </div>
  </div>

  <!-- Center - Game Board -->
  <div class="game-board">
    <div class="game-header">
      <div class="game-title">
        <span>üçã</span> LEMON BLACKJACK <span class="made-by">- made by mize</span>
      </div>
      <div class="game-badges">
        <span class="badge badge-decks">6 Decks</span>
        <span class="badge badge-bet" id="currentBetBadge">10 üçã Bet</span>
      </div>
    </div>

    <div class="table-felt" id="tableFelt">
      <!-- Dealer Area -->
      <div class="dealer-area">
        <div class="hand-label">Dealer</div>
        <div class="hand-value" id="dealerValue">-</div>
        <div class="cards-container" id="dealerCards">
          <!-- Dealer cards will appear here -->
        </div>
      </div>

      <!-- Player Area -->
      <div class="player-area">
        <div class="cards-container" id="playerCards">
          <!-- Player cards will appear here -->
        </div>
        <div class="hand-value" id="playerValue" style="margin-top: 16px; margin-bottom: 0;">-</div>
        <div class="hand-label" style="margin-top: 12px;">Player</div>
      </div>

      <!-- Game Message -->
      <div class="game-message" id="gameMessage" style="display: none;"></div>

      <!-- Insurance Prompt -->
      <div class="insurance-prompt" id="insurancePrompt" style="display: none;">
        <h3>Insurance?</h3>
        <p>Dealer shows Ace. Take insurance? (Half your bet)</p>
        <div class="insurance-buttons">
          <button class="insurance-btn insurance-yes" onclick="takeInsurance(true)">Yes</button>
          <button class="insurance-btn insurance-no" onclick="takeInsurance(false)">No</button>
        </div>
      </div>
    </div>

    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-label">Hands Played</div>
        <div class="stat-value" id="statHands">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Wins</div>
        <div class="stat-value" id="statWins" style="color: #22c55e;">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Losses</div>
        <div class="stat-value" id="statLosses" style="color: #ef4444;">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Blackjacks</div>
        <div class="stat-value" id="statBlackjacks" style="color: #facc15;">0</div>
      </div>
    </div>
  </div>

  <!-- Right Panel - History -->
  <div class="panel right-panel">
    <div class="history-title">
      <span>üìä</span> History
    </div>
    <div class="history-list" id="historyList">
      <div class="history-empty">No hands played yet</div>
    </div>
  </div>

  <script>
    // Card suits and ranks
    const SUITS = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
    const RANKS = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
    const RANK_VALUES = {
      'A': 11, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7,
      '8': 8, '9': 9, '10': 10, 'J': 10, 'Q': 10, 'K': 10
    };

    // Game state
    let balance = 1000;
    let betAmount = 10;
    let currentBet = 0;
    let deck = [];
    let dealerHand = [];
    let playerHand = [];
    let gameInProgress = false;
    let playerTurn = false;
    let insuranceBet = 0;
    let hasDoubled = false;
    let totalProfit = 0;
    let stats = { hands: 0, wins: 0, losses: 0, blackjacks: 0 };
    let history = [];
    let gameIdCounter = 0;

    // Create and shuffle deck (6 decks)
    function createDeck() {
      deck = [];
      for (let d = 0; d < 6; d++) {
        for (const suit of SUITS) {
          for (const rank of RANKS) {
            deck.push({ rank, suit });
          }
        }
      }
      shuffleDeck();
    }

    function shuffleDeck() {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
    }

    // Draw a card
    function drawCard() {
      if (deck.length < 52) {
        createDeck();
      }
      return deck.pop();
    }

    // Calculate hand value
    function calculateHand(hand) {
      let value = 0;
      let aces = 0;

      for (const card of hand) {
        value += RANK_VALUES[card.rank];
        if (card.rank === 'A') aces++;
      }

      while (value > 21 && aces > 0) {
        value -= 10;
        aces--;
      }

      return value;
    }

    // Check for blackjack
    function isBlackjack(hand) {
      return hand.length === 2 && calculateHand(hand) === 21;
    }

    // Create card element
    function createCardElement(card, faceDown = false) {
      const cardEl = document.createElement('div');
      
      if (faceDown) {
        cardEl.className = 'card face-down';
      } else {
        const isRed = card.suit === '‚ô•' || card.suit === '‚ô¶';
        cardEl.className = `card ${isRed ? 'red' : 'black'}`;
        cardEl.innerHTML = `
          <div class="card-corner">
            <span class="card-rank">${card.rank}</span>
            <span class="card-suit">${card.suit}</span>
          </div>
          <div class="card-center">${card.suit}</div>
          <div class="card-corner bottom">
            <span class="card-rank">${card.rank}</span>
            <span class="card-suit">${card.suit}</span>
          </div>
        `;
      }
      
      return cardEl;
    }

    // Render hands
    function renderHands(showDealerCard = false) {
      const dealerContainer = document.getElementById('dealerCards');
      const playerContainer = document.getElementById('playerCards');
      
      dealerContainer.innerHTML = '';
      playerContainer.innerHTML = '';

      dealerHand.forEach((card, index) => {
        const faceDown = index === 1 && !showDealerCard && gameInProgress;
        dealerContainer.appendChild(createCardElement(card, faceDown));
      });

      playerHand.forEach(card => {
        playerContainer.appendChild(createCardElement(card));
      });

      // Update values
      const dealerValue = calculateHand(dealerHand);
      const playerValue = calculateHand(playerHand);

      const dealerValueEl = document.getElementById('dealerValue');
      const playerValueEl = document.getElementById('playerValue');

      if (showDealerCard || !gameInProgress) {
        dealerValueEl.textContent = dealerValue;
        dealerValueEl.className = 'hand-value' + 
          (dealerValue > 21 ? ' bust' : '') +
          (isBlackjack(dealerHand) ? ' blackjack' : '');
      } else {
        const visibleCard = dealerHand[0];
        dealerValueEl.textContent = RANK_VALUES[visibleCard.rank] + ' + ?';
        dealerValueEl.className = 'hand-value';
      }

      playerValueEl.textContent = playerValue;
      playerValueEl.className = 'hand-value' + 
        (playerValue > 21 ? ' bust' : '') +
        (isBlackjack(playerHand) ? ' blackjack' : '');
    }

    // Start new game
    function startGame() {
      if (balance < betAmount) return;

      // Reset state
      gameInProgress = true;
      playerTurn = true;
      hasDoubled = false;
      insuranceBet = 0;
      currentBet = betAmount;
      
      balance -= currentBet;
      updateBalance();
      updateBetBadge();

      // Hide message
      document.getElementById('gameMessage').style.display = 'none';

      // Create new deck if needed
      if (deck.length < 52) {
        createDeck();
      }

      // Deal cards
      dealerHand = [drawCard(), drawCard()];
      playerHand = [drawCard(), drawCard()];

      renderHands();
      updateButtons();

      // Check for dealer ace (insurance)
      if (dealerHand[0].rank === 'A') {
        document.getElementById('insurancePrompt').style.display = 'block';
        disableAllActions();
        return;
      }

      // Check for blackjacks
      checkInitialBlackjacks();
    }

    // Take insurance
    function takeInsurance(yes) {
      document.getElementById('insurancePrompt').style.display = 'none';
      
      if (yes && balance >= currentBet / 2) {
        insuranceBet = currentBet / 2;
        balance -= insuranceBet;
        updateBalance();
      }

      checkInitialBlackjacks();
    }

    // Check for initial blackjacks
    function checkInitialBlackjacks() {
      const playerBJ = isBlackjack(playerHand);
      const dealerBJ = isBlackjack(dealerHand);

      if (dealerBJ || playerBJ) {
        renderHands(true);
        
        if (dealerBJ && playerBJ) {
          endGame('push', 0);
        } else if (playerBJ) {
          const winAmount = currentBet * 2.5; // 3:2 payout
          endGame('blackjack', winAmount - currentBet);
        } else {
          // Dealer blackjack
          if (insuranceBet > 0) {
            // Insurance pays 2:1
            balance += insuranceBet * 3;
            updateBalance();
          }
          endGame('lose', -currentBet);
        }
        return;
      }

      // No blackjacks, player's turn
      updateButtons();
    }

    // Hit
    function hit() {
      if (!playerTurn) return;

      playerHand.push(drawCard());
      renderHands();

      if (calculateHand(playerHand) > 21) {
        endGame('lose', -currentBet - (hasDoubled ? currentBet : 0));
      } else {
        updateButtons();
      }

      // After hitting, can't double or split
      document.getElementById('doubleBtn').disabled = true;
      document.getElementById('splitBtn').disabled = true;
    }

    // Stand
    function stand() {
      if (!playerTurn) return;
      
      playerTurn = false;
      dealerPlay();
    }

    // Double down
    function doubleDown() {
      if (!playerTurn || balance < currentBet) return;

      balance -= currentBet;
      currentBet *= 2;
      hasDoubled = true;
      updateBalance();
      updateBetBadge();

      playerHand.push(drawCard());
      renderHands();

      if (calculateHand(playerHand) > 21) {
        endGame('lose', -currentBet);
      } else {
        playerTurn = false;
        dealerPlay();
      }
    }

    // Split (simplified - no re-splitting)
    function split() {
      // For simplicity, splitting is not fully implemented
      // It would require managing multiple hands
      alert('Split functionality coming soon!');
    }

    // Dealer plays
    async function dealerPlay() {
      disableAllActions();
      renderHands(true);

      await sleep(500);

      while (calculateHand(dealerHand) < 17) {
        dealerHand.push(drawCard());
        renderHands(true);
        await sleep(500);
      }

      determineWinner();
    }

    // Determine winner
    function determineWinner() {
      const playerValue = calculateHand(playerHand);
      const dealerValue = calculateHand(dealerHand);

      if (dealerValue > 21) {
        endGame('win', currentBet);
      } else if (playerValue > dealerValue) {
        endGame('win', currentBet);
      } else if (playerValue < dealerValue) {
        endGame('lose', -currentBet);
      } else {
        endGame('push', 0);
      }
    }

    // End game
    function endGame(result, profit) {
      gameInProgress = false;
      playerTurn = false;
      renderHands(true);

      // Calculate actual profit (including returned bet)
      if (result === 'win' || result === 'blackjack') {
        balance += currentBet + profit + currentBet; // Return bet + winnings
      } else if (result === 'push') {
        balance += currentBet; // Return bet
      }
      
      totalProfit += profit;
      
      // Update stats
      stats.hands++;
      if (result === 'win' || result === 'blackjack') {
        stats.wins++;
      } else if (result === 'lose') {
        stats.losses++;
      }
      if (result === 'blackjack') {
        stats.blackjacks++;
      }

      updateBalance();
      updateStats();
      updateProfit();
      showResult(result, profit);
      addToHistory(result, profit);
      updateButtons();
    }

    // Show result message
    function showResult(result, profit) {
      const messageEl = document.getElementById('gameMessage');
      const resultBox = document.getElementById('lastResult');
      const resultValue = document.getElementById('lastResultValue');

      let message = '';
      let className = 'game-message ';

      switch (result) {
        case 'win':
          message = `WIN! +${profit.toFixed(2)} üçã`;
          className += 'win';
          break;
        case 'lose':
          message = `LOSE ${profit.toFixed(2)} üçã`;
          className += 'lose';
          break;
        case 'push':
          message = 'PUSH - Bet Returned';
          className += 'push';
          break;
        case 'blackjack':
          message = `BLACKJACK! +${profit.toFixed(2)} üçã`;
          className += 'blackjack';
          break;
      }

      messageEl.textContent = message;
      messageEl.className = className;
      messageEl.style.display = 'block';

      // Update last result box
      resultBox.style.display = 'block';
      resultBox.className = result === 'push' ? 'result-box push' : (profit >= 0 ? 'result-box win' : 'result-box loss');
      resultValue.className = result === 'push' ? 'result-value push' : (profit >= 0 ? 'result-value win' : 'result-value loss');
      resultValue.textContent = `${profit >= 0 ? '+' : ''}${profit.toFixed(2)} üçã`;
    }

    // Add to history
    function addToHistory(result, profit) {
      const playerValue = calculateHand(playerHand);
      const dealerValue = calculateHand(dealerHand);
      
      history.unshift({
        id: gameIdCounter++,
        result,
        profit,
        playerValue,
        dealerValue,
        bet: currentBet
      });

      if (history.length > 20) history.pop();

      const historyList = document.getElementById('historyList');
      
      if (history.length === 1) {
        historyList.innerHTML = '';
      }

      const item = document.createElement('div');
      item.className = 'history-item';
      
      let resultClass = result;
      let resultText = result.toUpperCase();
      if (result === 'blackjack') {
        resultText = 'BLACKJACK';
      }

      item.innerHTML = `
        <div class="history-item-header">
          <span class="history-result ${resultClass}">${resultText}</span>
          <span class="history-profit ${profit >= 0 ? 'win' : 'loss'}">
            ${profit >= 0 ? '+' : ''}${profit.toFixed(2)} üçã
          </span>
        </div>
        <div class="history-hands">
          Player: ${playerValue} vs Dealer: ${dealerValue}
        </div>
      `;

      historyList.insertBefore(item, historyList.firstChild);

      while (historyList.children.length > 20) {
        historyList.removeChild(historyList.lastChild);
      }
    }

    // Update buttons
    function updateButtons() {
      const dealBtn = document.getElementById('dealBtn');
      const hitBtn = document.getElementById('hitBtn');
      const standBtn = document.getElementById('standBtn');
      const doubleBtn = document.getElementById('doubleBtn');
      const splitBtn = document.getElementById('splitBtn');
      const betInput = document.getElementById('betInput');
      const betBtns = ['betHalf', 'betDouble', 'betMax'];

      if (gameInProgress) {
        dealBtn.disabled = true;
        hitBtn.disabled = !playerTurn;
        standBtn.disabled = !playerTurn;
        doubleBtn.disabled = !playerTurn || playerHand.length !== 2 || balance < currentBet;
        splitBtn.disabled = true; // Simplified - no split
        betInput.disabled = true;
        betBtns.forEach(id => document.getElementById(id).disabled = true);
      } else {
        dealBtn.disabled = balance < betAmount;
        hitBtn.disabled = true;
        standBtn.disabled = true;
        doubleBtn.disabled = true;
        splitBtn.disabled = true;
        betInput.disabled = false;
        betBtns.forEach(id => document.getElementById(id).disabled = false);
      }
    }

    // Disable all action buttons
    function disableAllActions() {
      document.getElementById('hitBtn').disabled = true;
      document.getElementById('standBtn').disabled = true;
      document.getElementById('doubleBtn').disabled = true;
      document.getElementById('splitBtn').disabled = true;
    }

    // Update balance display
    function updateBalance() {
      document.getElementById('balanceValue').textContent = balance.toFixed(2);
    }

    // Update bet badge
    function updateBetBadge() {
      document.getElementById('currentBetBadge').textContent = `${currentBet} üçã Bet`;
    }

    // Update stats
    function updateStats() {
      document.getElementById('statHands').textContent = stats.hands;
      document.getElementById('statWins').textContent = stats.wins;
      document.getElementById('statLosses').textContent = stats.losses;
      document.getElementById('statBlackjacks').textContent = stats.blackjacks;
    }

    // Update profit display
    function updateProfit() {
      const profitEl = document.getElementById('profitValue');
      profitEl.textContent = `${totalProfit >= 0 ? '+' : ''}${totalProfit.toFixed(2)} üçã`;
      profitEl.className = totalProfit >= 0 ? 'result-value win' : 'result-value loss';
    }

    // Helper functions
    function adjustBet(multiplier) {
      if (gameInProgress) return;
      betAmount = Math.max(1, Math.min(balance, Math.floor(betAmount * multiplier)));
      document.getElementById('betInput').value = betAmount;
      updateBetBadge();
      updateButtons();
    }

    function setBetMax() {
      if (gameInProgress) return;
      betAmount = Math.floor(balance);
      document.getElementById('betInput').value = betAmount;
      updateBetBadge();
      updateButtons();
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Event listeners
    document.getElementById('betInput').addEventListener('change', function() {
      if (gameInProgress) return;
      betAmount = Math.max(1, Math.min(balance, parseInt(this.value) || 1));
      this.value = betAmount;
      document.getElementById('currentBetBadge').textContent = `${betAmount} üçã Bet`;
      updateButtons();
    });

    // Initialize
    createDeck();
    updateBalance();
    updateButtons();
    updateBetBadge();
  </script>
</body>
</html>
