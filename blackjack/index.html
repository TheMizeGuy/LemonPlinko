<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lemon Blackjack</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #0a0e1a 0%, #151c2c 50%, #0d1320 100%);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: #fff;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 24px;
    }

    .panel {
      background: linear-gradient(180deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px);
    }

    .left-panel {
      width: 320px;
    }

    .right-panel {
      width: 280px;
      max-height: 750px;
      overflow: hidden;
    }

    .balance-display {
      background: linear-gradient(135deg, rgba(250, 204, 21, 0.15) 0%, rgba(234, 179, 8, 0.1) 100%);
      border-radius: 14px;
      padding: 20px;
      margin-bottom: 24px;
      border: 1px solid rgba(250, 204, 21, 0.2);
    }

    .balance-label {
      font-size: 12px;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .balance-value {
      font-size: 32px;
      font-weight: 700;
      color: #facc15;
      font-family: 'JetBrains Mono', monospace;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-label {
      font-size: 13px;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: block;
      margin-bottom: 10px;
    }

    .bet-input {
      width: 100%;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 14px;
      color: #fff;
      font-size: 18px;
      font-family: 'JetBrains Mono', monospace;
      outline: none;
    }

    .bet-input:focus {
      border-color: rgba(250, 204, 21, 0.5);
    }

    .bet-input:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-group {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .btn-small {
      flex: 1;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #9ca3af;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-small:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.1);
    }

    .btn-small:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .side-bet-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 10px;
      margin-bottom: 8px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.2s;
    }

    .side-bet-row:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .side-bet-row.active {
      background: rgba(250, 204, 21, 0.1);
      border-color: rgba(250, 204, 21, 0.3);
    }

    .side-bet-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .side-bet-check {
      width: 18px;
      height: 18px;
      accent-color: #facc15;
      cursor: pointer;
    }

    .side-bet-check:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }

    .side-bet-label {
      display: flex;
      flex-direction: column;
      cursor: pointer;
    }

    .side-bet-name {
      font-size: 14px;
      font-weight: 600;
      color: #fff;
    }

    .side-bet-odds {
      font-size: 11px;
      color: #facc15;
      font-family: 'JetBrains Mono', monospace;
    }

    .side-bet-input {
      width: 70px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 8px 10px;
      color: #fff;
      font-size: 14px;
      font-family: 'JetBrains Mono', monospace;
      text-align: center;
    }

    .side-bet-input:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .side-bet-input:focus {
      outline: none;
      border-color: rgba(250, 204, 21, 0.5);
    }

    .side-bet-result {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.9);
      padding: 12px 16px;
      border-radius: 12px;
      z-index: 15;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .side-bet-result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .side-bet-result-item:last-child {
      border-bottom: none;
    }

    .side-bet-result-name {
      font-size: 12px;
      color: #9ca3af;
    }

    .side-bet-result-value {
      font-size: 14px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .side-bet-result-value.win {
      color: #22c55e;
    }

    .side-bet-result-value.lose {
      color: #ef4444;
    }

    .btn-play {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #facc15 0%, #eab308 100%);
      border: none;
      border-radius: 14px;
      color: #000;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 20px rgba(250, 204, 21, 0.4);
      margin-bottom: 12px;
    }

    .btn-play:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 6px 25px rgba(250, 204, 21, 0.5);
    }

    .btn-play:disabled {
      background: rgba(255, 255, 255, 0.1);
      color: #6b7280;
      box-shadow: none;
      cursor: not-allowed;
      transform: none;
    }

    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 16px;
    }

    .btn-action {
      padding: 16px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }

    .btn-hit {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.3) 0%, rgba(22, 163, 74, 0.2) 100%);
      border-color: #22c55e;
      color: #22c55e;
    }

    .btn-hit:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.5) 0%, rgba(22, 163, 74, 0.4) 100%);
    }

    .btn-stand {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(220, 38, 38, 0.2) 100%);
      border-color: #ef4444;
      color: #ef4444;
    }

    .btn-stand:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.5) 0%, rgba(220, 38, 38, 0.4) 100%);
    }

    .btn-double {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(37, 99, 235, 0.2) 100%);
      border-color: #3b82f6;
      color: #3b82f6;
    }

    .btn-double:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.5) 0%, rgba(37, 99, 235, 0.4) 100%);
    }

    .btn-split {
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.3) 0%, rgba(139, 92, 246, 0.2) 100%);
      border-color: #a855f7;
      color: #a855f7;
    }

    .btn-split:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.5) 0%, rgba(139, 92, 246, 0.4) 100%);
    }

    .btn-action:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      transform: none;
    }

    .result-box {
      margin-top: 20px;
      padding: 14px;
      border-radius: 12px;
    }

    .result-box.win {
      background: rgba(250, 204, 21, 0.15);
      border: 1px solid rgba(250, 204, 21, 0.3);
    }

    .result-box.loss {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .result-box.push {
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .result-label {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    .result-value {
      font-size: 22px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .result-value.win {
      color: #facc15;
    }

    .result-value.loss {
      color: #ef4444;
    }

    .result-value.push {
      color: #3b82f6;
    }

    .profit-box {
      margin-top: 14px;
      padding: 14px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .game-board {
      background: linear-gradient(180deg, rgba(30, 41, 59, 0.6) 0%, rgba(15, 23, 42, 0.8) 100%);
      border-radius: 24px;
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      min-width: 600px;
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .game-title {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, #facc15 0%, #eab308 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .made-by {
      font-size: 14px;
      font-weight: 400;
      color: #9ca3af;
      margin-left: 8px;
      font-style: italic;
      -webkit-text-fill-color: #9ca3af;
    }

    .game-badges {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .badge {
      font-size: 13px;
      padding: 8px 14px;
      border-radius: 20px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .badge-decks {
      background: rgba(59, 130, 246, 0.2);
      color: #60a5fa;
    }

    .badge-bet {
      background: rgba(250, 204, 21, 0.2);
      color: #facc15;
    }

    .table-felt {
      background: linear-gradient(180deg, #1a472a 0%, #15803d 50%, #166534 100%);
      border-radius: 20px;
      padding: 30px;
      min-height: 400px;
      position: relative;
      border: 8px solid #854d0e;
      box-shadow: inset 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .dealer-area {
      text-align: center;
      margin-bottom: 40px;
    }

    .player-area {
      text-align: center;
    }

    .hands-container {
      display: flex;
      justify-content: center;
      gap: 30px;
    }

    .hand-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
      border-radius: 12px;
      transition: all 0.3s ease;
      position: relative;
    }

    .hand-wrapper.active {
      background: rgba(250, 204, 21, 0.1);
      box-shadow: 0 0 20px rgba(250, 204, 21, 0.2);
    }

    .hand-wrapper.completed {
      opacity: 0.7;
    }

    .hand-wrapper.won {
      background: rgba(34, 197, 94, 0.15);
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
    }

    .hand-wrapper.lost {
      background: rgba(239, 68, 68, 0.15);
      box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
    }

    .hand-wrapper.pushed {
      background: rgba(59, 130, 246, 0.15);
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
    }

    .hand-indicator {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      font-weight: 700;
      padding: 4px 12px;
      border-radius: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: none;
    }

    .hand-wrapper.active .hand-indicator {
      display: block;
      background: rgba(250, 204, 21, 0.9);
      color: #000;
    }

    .hand-wrapper.won .hand-indicator {
      display: block;
      background: #22c55e;
      color: #fff;
    }

    .hand-wrapper.lost .hand-indicator {
      display: block;
      background: #ef4444;
      color: #fff;
    }

    .hand-wrapper.pushed .hand-indicator {
      display: block;
      background: #3b82f6;
      color: #fff;
    }

    .hand-label {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 12px;
    }

    .hand-value {
      display: inline-block;
      background: rgba(0, 0, 0, 0.5);
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 20px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      color: #fff;
      margin-bottom: 16px;
    }

    .hand-value.blackjack {
      background: linear-gradient(135deg, #facc15 0%, #eab308 100%);
      color: #000;
    }

    .hand-value.bust {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: #fff;
    }

    .cards-container {
      display: flex;
      justify-content: center;
      gap: 12px;
      min-height: 120px;
      flex-wrap: wrap;
    }

    .card {
      width: 80px;
      height: 112px;
      background: linear-gradient(180deg, #fff 0%, #f3f4f6 100%);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 8px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      position: relative;
      animation: dealCard 0.3s ease-out;
      transform-origin: center;
    }

    @keyframes dealCard {
      0% {
        transform: translateY(-50px) rotate(-10deg) scale(0.8);
        opacity: 0;
      }
      100% {
        transform: translateY(0) rotate(0) scale(1);
        opacity: 1;
      }
    }

    .card.face-down {
      background: linear-gradient(135deg, #1e40af 0%, #1d4ed8 50%, #2563eb 100%);
      border: 3px solid #3b82f6;
    }

    .card.face-down::before {
      content: 'üçã';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 32px;
    }

    .card.face-down::after {
      content: '';
      position: absolute;
      inset: 8px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
    }

    .card-corner {
      display: flex;
      flex-direction: column;
      align-items: center;
      line-height: 1;
    }

    .card-corner.bottom {
      align-self: flex-end;
      transform: rotate(180deg);
    }

    .card-rank {
      font-size: 18px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .card-suit {
      font-size: 16px;
    }

    .card.red .card-rank,
    .card.red .card-suit {
      color: #dc2626;
    }

    .card.black .card-rank,
    .card.black .card-suit {
      color: #1f2937;
    }

    .card-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 36px;
    }

    .game-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      padding: 20px 40px;
      border-radius: 16px;
      font-size: 28px;
      font-weight: 800;
      text-align: center;
      z-index: 10;
      animation: messagePopup 0.4s ease-out;
    }

    @keyframes messagePopup {
      0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
      }
      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }

    .game-message.win {
      border: 3px solid #facc15;
      color: #facc15;
    }

    .game-message.lose {
      border: 3px solid #ef4444;
      color: #ef4444;
    }

    .game-message.push {
      border: 3px solid #3b82f6;
      color: #3b82f6;
    }

    .game-message.blackjack {
      border: 3px solid #facc15;
      background: linear-gradient(135deg, rgba(250, 204, 21, 0.2) 0%, rgba(0, 0, 0, 0.9) 100%);
      color: #facc15;
    }

    .stats-bar {
      display: flex;
      justify-content: space-around;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      padding: 16px 20px;
      margin-top: 20px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-label {
      font-size: 11px;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 20px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      color: #fff;
    }

    .history-title {
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 600px;
      overflow-y: auto;
    }

    .history-empty {
      color: #6b7280;
      font-size: 14px;
      text-align: center;
      padding: 50px 0;
    }

    .history-item {
      padding: 12px 14px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .history-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .history-result {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
    }

    .history-result.win {
      background: rgba(250, 204, 21, 0.2);
      color: #facc15;
    }

    .history-result.lose {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .history-result.push {
      background: rgba(59, 130, 246, 0.2);
      color: #3b82f6;
    }

    .history-result.blackjack {
      background: linear-gradient(135deg, rgba(250, 204, 21, 0.3) 0%, rgba(234, 179, 8, 0.2) 100%);
      color: #facc15;
    }

    .history-profit {
      font-size: 14px;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
    }

    .history-profit.win {
      color: #facc15;
    }

    .history-profit.loss {
      color: #ef4444;
    }

    .history-hands {
      font-size: 12px;
      color: #9ca3af;
      font-family: 'JetBrains Mono', monospace;
    }

    .history-sidebets {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .history-sidebet {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 4px;
      font-family: 'JetBrains Mono', monospace;
    }

    .history-sidebet.win {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    .history-sidebet.lose {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
    }

    .section {
      margin-bottom: 20px;
    }

    .insurance-prompt {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.95);
      padding: 24px 32px;
      border-radius: 16px;
      border: 2px solid #facc15;
      text-align: center;
      z-index: 20;
    }

    .insurance-prompt h3 {
      font-size: 20px;
      color: #facc15;
      margin-bottom: 12px;
    }

    .insurance-prompt p {
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 16px;
    }

    .insurance-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .insurance-btn {
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .insurance-yes {
      background: linear-gradient(135deg, #facc15 0%, #eab308 100%);
      border: none;
      color: #000;
    }

    .insurance-no {
      background: transparent;
      border: 2px solid #6b7280;
      color: #9ca3af;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .lemon-icon {
      font-size: 20px;
    }

    .payouts-info {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      padding: 16px;
    }

    .payouts-info-section {
      flex: 1;
    }

    .payouts-info-title {
      font-size: 12px;
      font-weight: 700;
      color: #facc15;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .payouts-info-row {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      padding: 4px 0;
      color: #9ca3af;
    }

    .payouts-info-row .payout-mult {
      color: #facc15;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
    }

    @media (max-width: 1100px) {
      body {
        flex-direction: column;
        align-items: center;
      }
      
      .left-panel, .right-panel {
        width: 100%;
        max-width: 500px;
      }

      .game-board {
        min-width: auto;
        width: 100%;
        max-width: 600px;
      }
    }
  </style>
</head>
<body>
  <!-- Left Panel - Controls -->
  <div class="panel left-panel">
    <!-- Balance Display -->
    <div class="balance-display">
      <div class="balance-label">
        <span class="lemon-icon">üçã</span> Balance
      </div>
      <div class="balance-value">
        <span id="balanceValue">1000.00</span>
        <span style="font-size: 16px; font-weight: 500;">Lemons</span>
      </div>
    </div>

    <!-- Bet Amount -->
    <div class="section">
      <label class="section-label">Bet Amount (Lemons)</label>
      <input type="number" id="betInput" class="bet-input" value="10" min="1">
      <div class="btn-group">
        <button class="btn-small" id="betHalf" onclick="adjustBet(0.5)">¬Ωx</button>
        <button class="btn-small" id="betDouble" onclick="adjustBet(2)">2x</button>
        <button class="btn-small" id="betMax" onclick="setBetMax()">MAX</button>
      </div>
    </div>

    <!-- Side Bets -->
    <div class="section">
      <label class="section-label">Side Bets</label>
      
      <div class="side-bet-row">
        <div class="side-bet-info">
          <input type="checkbox" id="perfectPairsCheck" class="side-bet-check" onchange="toggleSideBet('perfectPairs')">
          <label for="perfectPairsCheck" class="side-bet-label">
            <span class="side-bet-name">Perfect Pairs</span>
            <span class="side-bet-odds">6x-30x</span>
          </label>
        </div>
        <input type="number" id="perfectPairsBet" class="side-bet-input" value="5" min="1" disabled>
      </div>

      <div class="side-bet-row">
        <div class="side-bet-info">
          <input type="checkbox" id="twentyOneCheck" class="side-bet-check" onchange="toggleSideBet('twentyOne')">
          <label for="twentyOneCheck" class="side-bet-label">
            <span class="side-bet-name">21+3</span>
            <span class="side-bet-odds">9x-100x</span>
          </label>
        </div>
        <input type="number" id="twentyOneBet" class="side-bet-input" value="5" min="1" disabled>
      </div>

      <div class="side-bet-row">
        <div class="side-bet-info">
          <input type="checkbox" id="insuranceAutoCheck" class="side-bet-check" onchange="toggleSideBet('insuranceAuto')">
          <label for="insuranceAutoCheck" class="side-bet-label">
            <span class="side-bet-name">Auto Insurance</span>
            <span class="side-bet-odds">2x</span>
          </label>
        </div>
      </div>
    </div>

    <!-- Deal Button -->
    <button class="btn-play" id="dealBtn" onclick="startGame()">
      üÉè Deal Cards
    </button>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn-action btn-hit" id="hitBtn" onclick="hit()" disabled>
        Hit
      </button>
      <button class="btn-action btn-stand" id="standBtn" onclick="stand()" disabled>
        Stand
      </button>
      <button class="btn-action btn-double" id="doubleBtn" onclick="doubleDown()" disabled>
        Double
      </button>
      <button class="btn-action btn-split" id="splitBtn" onclick="split()" disabled>
        Split
      </button>
    </div>

    <!-- Last Result -->
    <div class="result-box win" id="lastResult" style="display: none;">
      <div class="result-label">Last Result</div>
      <div class="result-value win" id="lastResultValue"></div>
    </div>

    <!-- Total Profit -->
    <div class="profit-box">
      <div class="result-label">Session Profit</div>
      <div class="result-value win" id="profitValue" style="font-size: 18px;">+0.00 üçã</div>
    </div>
  </div>

  <!-- Center - Game Board -->
  <div class="game-board">
    <div class="game-header">
      <div class="game-title">
        <span>üçã</span> LEMON BLACKJACK <span class="made-by">- made by mize</span>
      </div>
      <div class="game-badges">
        <span class="badge badge-decks">6 Decks</span>
        <span class="badge badge-bet" id="currentBetBadge">10 üçã Bet</span>
      </div>
    </div>

    <div class="table-felt" id="tableFelt">
      <!-- Side Bet Results -->
      <div class="side-bet-result" id="sideBetResult" style="display: none;"></div>

      <!-- Dealer Area -->
      <div class="dealer-area">
        <div class="hand-label">Dealer</div>
        <div class="hand-value" id="dealerValue">-</div>
        <div class="cards-container" id="dealerCards">
          <!-- Dealer cards will appear here -->
        </div>
      </div>

      <!-- Player Area -->
      <div class="player-area">
        <div class="hands-container" id="handsContainer">
          <div class="hand-wrapper active" id="hand0Wrapper">
            <div class="cards-container" id="playerCards">
              <!-- Player cards will appear here -->
            </div>
            <div class="hand-value" id="playerValue" style="margin-top: 16px; margin-bottom: 0;">-</div>
            <div class="hand-indicator" id="hand0Indicator"></div>
          </div>
          <div class="hand-wrapper" id="hand1Wrapper" style="display: none;">
            <div class="cards-container" id="splitCards">
              <!-- Split hand cards will appear here -->
            </div>
            <div class="hand-value" id="splitValue" style="margin-top: 16px; margin-bottom: 0;">-</div>
            <div class="hand-indicator" id="hand1Indicator"></div>
          </div>
        </div>
        <div class="hand-label" style="margin-top: 12px;">Player</div>
      </div>

      <!-- Game Message -->
      <div class="game-message" id="gameMessage" style="display: none;"></div>

      <!-- Insurance Prompt -->
      <div class="insurance-prompt" id="insurancePrompt" style="display: none;">
        <h3>Insurance?</h3>
        <p>Dealer shows Ace. Take insurance? (Half your bet)</p>
        <div class="insurance-buttons">
          <button class="insurance-btn insurance-yes" onclick="takeInsurance(true)">Yes</button>
          <button class="insurance-btn insurance-no" onclick="takeInsurance(false)">No</button>
        </div>
      </div>
    </div>

    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-label">Hands Played</div>
        <div class="stat-value" id="statHands">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Wins</div>
        <div class="stat-value" id="statWins" style="color: #22c55e;">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Losses</div>
        <div class="stat-value" id="statLosses" style="color: #ef4444;">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Blackjacks</div>
        <div class="stat-value" id="statBlackjacks" style="color: #facc15;">0</div>
      </div>
    </div>

    <!-- Side Bet Payouts Info -->
    <div class="payouts-info">
      <div class="payouts-info-section">
        <div class="payouts-info-title">Perfect Pairs</div>
        <div class="payouts-info-row"><span>Perfect Pair (same suit)</span><span class="payout-mult">30x</span></div>
        <div class="payouts-info-row"><span>Colored Pair (same color)</span><span class="payout-mult">12x</span></div>
        <div class="payouts-info-row"><span>Mixed Pair (diff color)</span><span class="payout-mult">6x</span></div>
      </div>
      <div class="payouts-info-section">
        <div class="payouts-info-title">21+3</div>
        <div class="payouts-info-row"><span>Suited Trips</span><span class="payout-mult">100x</span></div>
        <div class="payouts-info-row"><span>Straight Flush</span><span class="payout-mult">40x</span></div>
        <div class="payouts-info-row"><span>Three of a Kind</span><span class="payout-mult">30x</span></div>
        <div class="payouts-info-row"><span>Straight</span><span class="payout-mult">10x</span></div>
        <div class="payouts-info-row"><span>Flush</span><span class="payout-mult">5x</span></div>
      </div>
      <div class="payouts-info-section">
        <div class="payouts-info-title">Main Game</div>
        <div class="payouts-info-row"><span>Blackjack</span><span class="payout-mult">3:2</span></div>
        <div class="payouts-info-row"><span>Insurance</span><span class="payout-mult">2:1</span></div>
        <div class="payouts-info-row"><span>Win</span><span class="payout-mult">1:1</span></div>
      </div>
    </div>
  </div>

  <!-- Right Panel - History -->
  <div class="panel right-panel">
    <div class="history-title">
      <span>üìä</span> History
    </div>
    <div class="history-list" id="historyList">
      <div class="history-empty">No hands played yet</div>
    </div>
  </div>

  <script>
    // Card suits and ranks
    const SUITS = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
    const RANKS = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
    const RANK_VALUES = {
      'A': 11, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7,
      '8': 8, '9': 9, '10': 10, 'J': 10, 'Q': 10, 'K': 10
    };

    // Game state
    let balance = 1000;
    let betAmount = 10;
    let currentBet = 0;
    let deck = [];
    let dealerHand = [];
    let playerHand = [];
    let splitHand = [];
    let currentHandIndex = 0; // 0 = main hand, 1 = split hand
    let handBets = [0, 0]; // Bets for each hand
    let handResults = [null, null]; // Results for each hand
    let hasSplit = false;
    let gameInProgress = false;
    let playerTurn = false;
    let insuranceBet = 0;
    let hasDoubled = false;
    let splitHandDoubled = false;
    let totalProfit = 0;
    let stats = { hands: 0, wins: 0, losses: 0, blackjacks: 0 };
    let history = [];
    let gameIdCounter = 0;

    // Side bet state
    let sideBets = {
      perfectPairs: { enabled: false, amount: 5 },
      twentyOne: { enabled: false, amount: 5 },
      insuranceAuto: { enabled: false }
    };
    let sideBetResults = [];

    // Perfect Pairs payouts
    const PERFECT_PAIRS_PAYOUTS = {
      perfectPair: 30,    // Same rank, same suit
      coloredPair: 12,    // Same rank, same color
      mixedPair: 6        // Same rank, different color
    };

    // 21+3 payouts (player's 2 cards + dealer's up card)
    const TWENTY_ONE_PAYOUTS = {
      suitedTrips: 100,   // Three of same rank and suit
      straightFlush: 40,  // Sequential same suit
      threeOfKind: 30,    // Three of same rank
      straight: 10,       // Sequential any suit
      flush: 5            // Same suit
    };

    // Create and shuffle deck (6 decks)
    function createDeck() {
      deck = [];
      for (let d = 0; d < 6; d++) {
        for (const suit of SUITS) {
          for (const rank of RANKS) {
            deck.push({ rank, suit });
          }
        }
      }
      shuffleDeck();
    }

    function shuffleDeck() {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
    }

    // Draw a card
    function drawCard() {
      if (deck.length < 52) {
        createDeck();
      }
      return deck.pop();
    }

    // Calculate hand value
    function calculateHand(hand) {
      let value = 0;
      let aces = 0;

      for (const card of hand) {
        value += RANK_VALUES[card.rank];
        if (card.rank === 'A') aces++;
      }

      while (value > 21 && aces > 0) {
        value -= 10;
        aces--;
      }

      return value;
    }

    // Check for blackjack
    function isBlackjack(hand) {
      return hand.length === 2 && calculateHand(hand) === 21;
    }

    // Create card element
    function createCardElement(card, faceDown = false) {
      const cardEl = document.createElement('div');
      
      if (faceDown) {
        cardEl.className = 'card face-down';
      } else {
        const isRed = card.suit === '‚ô•' || card.suit === '‚ô¶';
        cardEl.className = `card ${isRed ? 'red' : 'black'}`;
        cardEl.innerHTML = `
          <div class="card-corner">
            <span class="card-rank">${card.rank}</span>
            <span class="card-suit">${card.suit}</span>
          </div>
          <div class="card-center">${card.suit}</div>
          <div class="card-corner bottom">
            <span class="card-rank">${card.rank}</span>
            <span class="card-suit">${card.suit}</span>
          </div>
        `;
      }
      
      return cardEl;
    }

    // Render hands
    function renderHands(showDealerCard = false) {
      const dealerContainer = document.getElementById('dealerCards');
      const playerContainer = document.getElementById('playerCards');
      const splitContainer = document.getElementById('splitCards');
      
      dealerContainer.innerHTML = '';
      playerContainer.innerHTML = '';
      if (splitContainer) splitContainer.innerHTML = '';

      dealerHand.forEach((card, index) => {
        const faceDown = index === 1 && !showDealerCard && gameInProgress;
        dealerContainer.appendChild(createCardElement(card, faceDown));
      });

      playerHand.forEach(card => {
        playerContainer.appendChild(createCardElement(card));
      });

      // Render split hand if exists
      if (hasSplit && splitContainer) {
        splitHand.forEach(card => {
          splitContainer.appendChild(createCardElement(card));
        });
      }

      // Update values
      const dealerValue = calculateHand(dealerHand);
      const playerValue = calculateHand(playerHand);
      const splitValue = hasSplit ? calculateHand(splitHand) : 0;

      const dealerValueEl = document.getElementById('dealerValue');
      const playerValueEl = document.getElementById('playerValue');
      const splitValueEl = document.getElementById('splitValue');

      if (showDealerCard || !gameInProgress) {
        dealerValueEl.textContent = dealerValue;
        dealerValueEl.className = 'hand-value' + 
          (dealerValue > 21 ? ' bust' : '') +
          (isBlackjack(dealerHand) ? ' blackjack' : '');
      } else {
        const visibleCard = dealerHand[0];
        dealerValueEl.textContent = RANK_VALUES[visibleCard.rank] + ' + ?';
        dealerValueEl.className = 'hand-value';
      }

      playerValueEl.textContent = playerValue;
      playerValueEl.className = 'hand-value' + 
        (playerValue > 21 ? ' bust' : '') +
        (isBlackjack(playerHand) && !hasSplit ? ' blackjack' : '');

      if (hasSplit && splitValueEl) {
        splitValueEl.textContent = splitValue;
        splitValueEl.className = 'hand-value' + 
          (splitValue > 21 ? ' bust' : '');
      }

      // Update hand wrapper indicators
      updateHandIndicators();
    }

    // Update hand indicators for split
    function updateHandIndicators() {
      const hand0Wrapper = document.getElementById('hand0Wrapper');
      const hand1Wrapper = document.getElementById('hand1Wrapper');
      const hand0Indicator = document.getElementById('hand0Indicator');
      const hand1Indicator = document.getElementById('hand1Indicator');

      if (!hasSplit) {
        hand0Wrapper.className = 'hand-wrapper' + (playerTurn ? ' active' : '');
        hand0Indicator.textContent = playerTurn ? 'Playing' : '';
        return;
      }

      // Show split hand wrapper
      hand1Wrapper.style.display = 'flex';

      // Update based on current hand and results
      if (gameInProgress && playerTurn) {
        if (currentHandIndex === 0) {
          hand0Wrapper.className = 'hand-wrapper active';
          hand0Indicator.textContent = 'Playing';
          hand1Wrapper.className = 'hand-wrapper';
          hand1Indicator.textContent = 'Waiting';
        } else {
          hand0Wrapper.className = 'hand-wrapper completed';
          hand0Indicator.textContent = calculateHand(playerHand) > 21 ? 'Bust' : 'Standing';
          hand1Wrapper.className = 'hand-wrapper active';
          hand1Indicator.textContent = 'Playing';
        }
      }

      // Update with results after game ends
      if (handResults[0]) {
        hand0Wrapper.className = 'hand-wrapper ' + handResults[0];
        hand0Indicator.textContent = handResults[0].toUpperCase();
      }
      if (handResults[1]) {
        hand1Wrapper.className = 'hand-wrapper ' + handResults[1];
        hand1Indicator.textContent = handResults[1].toUpperCase();
      }
    }

    // Start new game
    function startGame() {
      if (balance < betAmount) return;

      // Calculate total needed (main bet + side bets)
      let totalNeeded = betAmount;
      if (sideBets.perfectPairs.enabled) {
        totalNeeded += parseInt(document.getElementById('perfectPairsBet').value) || 5;
      }
      if (sideBets.twentyOne.enabled) {
        totalNeeded += parseInt(document.getElementById('twentyOneBet').value) || 5;
      }
      
      if (balance < totalNeeded) {
        alert('Insufficient balance for all bets!');
        return;
      }

      // Reset state
      gameInProgress = true;
      playerTurn = true;
      hasDoubled = false;
      splitHandDoubled = false;
      hasSplit = false;
      insuranceBet = 0;
      currentBet = betAmount;
      currentHandIndex = 0;
      splitHand = [];
      handBets = [betAmount, 0];
      handResults = [null, null];
      sideBetResults = [];
      
      balance -= currentBet;
      updateBalance();
      updateBetBadge();

      // Hide messages and reset UI
      document.getElementById('gameMessage').style.display = 'none';
      document.getElementById('sideBetResult').style.display = 'none';
      document.getElementById('hand1Wrapper').style.display = 'none';
      document.getElementById('hand0Wrapper').className = 'hand-wrapper active';
      document.getElementById('hand0Indicator').textContent = '';
      document.getElementById('hand1Indicator').textContent = '';

      // Create new deck if needed
      if (deck.length < 52) {
        createDeck();
      }

      // Deal cards
      dealerHand = [drawCard(), drawCard()];
      playerHand = [drawCard(), drawCard()];

      renderHands();
      
      // Process side bets after initial deal
      processSideBets();
      
      updateButtons();

      // Check for dealer ace (insurance)
      if (dealerHand[0].rank === 'A') {
        if (sideBets.insuranceAuto.enabled && balance >= currentBet / 2) {
          // Auto-take insurance
          insuranceBet = currentBet / 2;
          balance -= insuranceBet;
          updateBalance();
          checkInitialBlackjacks();
        } else if (!sideBets.insuranceAuto.enabled) {
          document.getElementById('insurancePrompt').style.display = 'block';
          disableAllActions();
          return;
        } else {
          checkInitialBlackjacks();
        }
        return;
      }

      // Check for blackjacks
      checkInitialBlackjacks();
    }

    // Take insurance
    function takeInsurance(yes) {
      document.getElementById('insurancePrompt').style.display = 'none';
      
      if (yes && balance >= currentBet / 2) {
        insuranceBet = currentBet / 2;
        balance -= insuranceBet;
        updateBalance();
      }

      checkInitialBlackjacks();
    }

    // Check for initial blackjacks
    function checkInitialBlackjacks() {
      const playerBJ = isBlackjack(playerHand);
      const dealerBJ = isBlackjack(dealerHand);

      if (dealerBJ || playerBJ) {
        renderHands(true);
        
        if (dealerBJ && playerBJ) {
          endGame('push', 0);
        } else if (playerBJ) {
          // Blackjack pays 3:2 (1.5x the bet as profit, plus original bet returned)
          const blackjackPayout = currentBet * 1.5;
          endGame('blackjack', blackjackPayout);
        } else {
          // Dealer blackjack
          if (insuranceBet > 0) {
            // Insurance pays 2:1
            balance += insuranceBet * 3;
            totalProfit += insuranceBet * 2;
            updateBalance();
            updateProfit();
          }
          endGame('lose', -currentBet);
        }
        return;
      }

      // No blackjacks, player's turn
      updateButtons();
    }

    // Hit
    function hit() {
      if (!playerTurn) return;

      const currentHand = currentHandIndex === 0 ? playerHand : splitHand;
      currentHand.push(drawCard());
      renderHands();

      const handValue = calculateHand(currentHand);
      
      if (handValue > 21) {
        // Current hand busts
        if (hasSplit && currentHandIndex === 0) {
          // Move to split hand
          currentHandIndex = 1;
          renderHands();
          updateButtons();
        } else if (hasSplit && currentHandIndex === 1) {
          // Both hands done, dealer plays
          playerTurn = false;
          dealerPlay();
        } else {
          // No split, just lose
          endGame('lose', -currentBet - (hasDoubled ? currentBet : 0));
        }
      } else {
        updateButtons();
      }

      // After hitting, can't double or split
      document.getElementById('doubleBtn').disabled = true;
      document.getElementById('splitBtn').disabled = true;
    }

    // Stand
    function stand() {
      if (!playerTurn) return;
      
      if (hasSplit && currentHandIndex === 0) {
        // Move to split hand
        currentHandIndex = 1;
        renderHands();
        updateButtons();
      } else {
        // Done with all hands, dealer plays
        playerTurn = false;
        dealerPlay();
      }
    }

    // Double down
    function doubleDown() {
      if (!playerTurn) return;
      
      const currentHand = currentHandIndex === 0 ? playerHand : splitHand;
      const currentHandBet = handBets[currentHandIndex];
      
      if (balance < currentHandBet) return;

      balance -= currentHandBet;
      handBets[currentHandIndex] *= 2;
      
      if (currentHandIndex === 0) {
        hasDoubled = true;
        currentBet *= 2;
      } else {
        splitHandDoubled = true;
      }
      
      updateBalance();
      updateBetBadge();

      currentHand.push(drawCard());
      renderHands();

      const handValue = calculateHand(currentHand);
      
      if (hasSplit) {
        if (currentHandIndex === 0) {
          // Move to split hand
          currentHandIndex = 1;
          renderHands();
          updateButtons();
        } else {
          // Both hands done, dealer plays
          playerTurn = false;
          dealerPlay();
        }
      } else {
        if (handValue > 21) {
          endGame('lose', -currentBet);
        } else {
          playerTurn = false;
          dealerPlay();
        }
      }
    }

    // Split
    function split() {
      if (!playerTurn || hasSplit) return;
      
      // Check if can split (same rank, have balance)
      if (playerHand.length !== 2) return;
      if (playerHand[0].rank !== playerHand[1].rank) return;
      if (balance < betAmount) return;

      // Deduct bet for split hand
      balance -= betAmount;
      updateBalance();

      // Set up split
      hasSplit = true;
      handBets = [betAmount, betAmount];
      currentBet = betAmount; // Reset to original bet for main hand
      
      // Move second card to split hand
      splitHand = [playerHand.pop()];
      
      // Deal one card to each hand
      playerHand.push(drawCard());
      splitHand.push(drawCard());

      // Show split hand wrapper
      document.getElementById('hand1Wrapper').style.display = 'flex';
      
      renderHands();
      updateButtons();
    }

    // Dealer plays
    async function dealerPlay() {
      disableAllActions();
      renderHands(true);

      // Check if all player hands busted
      if (hasSplit) {
        const hand1Bust = calculateHand(playerHand) > 21;
        const hand2Bust = calculateHand(splitHand) > 21;
        
        if (hand1Bust && hand2Bust) {
          // Both hands busted, no need for dealer to play
          handResults[0] = 'lost';
          handResults[1] = 'lost';
          const totalLoss = -(handBets[0] + handBets[1]);
          renderHands(true);
          endSplitGame(totalLoss);
          return;
        }
      }

      await sleep(500);

      while (calculateHand(dealerHand) < 17) {
        dealerHand.push(drawCard());
        renderHands(true);
        await sleep(500);
      }

      determineWinner();
    }

    // Determine winner
    function determineWinner() {
      const dealerValue = calculateHand(dealerHand);
      
      if (hasSplit) {
        // Handle split hands
        let totalProfit = 0;
        const playerValue = calculateHand(playerHand);
        const splitValue = calculateHand(splitHand);
        
        // Check main hand
        if (playerValue > 21) {
          handResults[0] = 'lost';
          totalProfit -= handBets[0];
        } else if (dealerValue > 21 || playerValue > dealerValue) {
          handResults[0] = 'won';
          totalProfit += handBets[0];
          balance += handBets[0] * 2;
        } else if (playerValue < dealerValue) {
          handResults[0] = 'lost';
          totalProfit -= handBets[0];
        } else {
          handResults[0] = 'pushed';
          balance += handBets[0];
        }
        
        // Check split hand
        if (splitValue > 21) {
          handResults[1] = 'lost';
          totalProfit -= handBets[1];
        } else if (dealerValue > 21 || splitValue > dealerValue) {
          handResults[1] = 'won';
          totalProfit += handBets[1];
          balance += handBets[1] * 2;
        } else if (splitValue < dealerValue) {
          handResults[1] = 'lost';
          totalProfit -= handBets[1];
        } else {
          handResults[1] = 'pushed';
          balance += handBets[1];
        }
        
        updateBalance();
        renderHands(true);
        endSplitGame(totalProfit);
      } else {
        // Single hand
        const playerValue = calculateHand(playerHand);
        
        if (dealerValue > 21) {
          endGame('win', currentBet);
        } else if (playerValue > dealerValue) {
          endGame('win', currentBet);
        } else if (playerValue < dealerValue) {
          endGame('lose', -currentBet);
        } else {
          endGame('push', 0);
        }
      }
    }

    // End split game
    function endSplitGame(profit) {
      gameInProgress = false;
      playerTurn = false;

      totalProfit += profit;
      
      // Update stats
      stats.hands++;
      if (profit > 0) {
        stats.wins++;
      } else if (profit < 0) {
        stats.losses++;
      }

      updateStats();
      updateProfit();
      showSplitResult(profit);
      addSplitToHistory(profit);
      updateButtons();
    }

    // Show split result message
    function showSplitResult(profit) {
      const messageEl = document.getElementById('gameMessage');
      const resultBox = document.getElementById('lastResult');
      const resultValue = document.getElementById('lastResultValue');

      let message = '';
      let className = 'game-message ';

      if (profit > 0) {
        message = `WIN! +${profit.toFixed(2)} üçã`;
        className += 'win';
      } else if (profit < 0) {
        message = `LOSE ${profit.toFixed(2)} üçã`;
        className += 'lose';
      } else {
        message = 'BREAK EVEN';
        className += 'push';
      }

      messageEl.textContent = message;
      messageEl.className = className;
      messageEl.style.display = 'block';

      // Update last result box
      resultBox.style.display = 'block';
      resultBox.className = profit > 0 ? 'result-box win' : (profit < 0 ? 'result-box loss' : 'result-box push');
      resultValue.className = profit > 0 ? 'result-value win' : (profit < 0 ? 'result-value loss' : 'result-value push');
      resultValue.textContent = `${profit >= 0 ? '+' : ''}${profit.toFixed(2)} üçã`;
    }

    // Add split game to history
    function addSplitToHistory(profit) {
      const playerValue = calculateHand(playerHand);
      const splitValue = calculateHand(splitHand);
      const dealerValue = calculateHand(dealerHand);
      
      history.unshift({
        id: gameIdCounter++,
        result: 'split',
        profit,
        playerValue,
        splitValue,
        dealerValue,
        bet: handBets[0] + handBets[1],
        handResults: [...handResults],
        sideBets: [...sideBetResults]
      });

      if (history.length > 20) history.pop();

      const historyList = document.getElementById('historyList');
      
      if (historyList.querySelector('.history-empty')) {
        historyList.innerHTML = '';
      }

      const item = document.createElement('div');
      item.className = 'history-item';
      
      const hand0Result = handResults[0];
      const hand1Result = handResults[1];

      let sideBetHtml = '';
      if (sideBetResults.length > 0) {
        sideBetHtml = '<div class="history-sidebets">';
        sideBetResults.forEach(sb => {
          const sbClass = sb.profit > 0 ? 'win' : 'lose';
          sideBetHtml += `<span class="history-sidebet ${sbClass}">${sb.name}: ${sb.profit > 0 ? '+' : ''}${sb.profit.toFixed(0)}</span>`;
        });
        sideBetHtml += '</div>';
      }

      item.innerHTML = `
        <div class="history-item-header">
          <span class="history-result ${profit >= 0 ? 'win' : 'lose'}">SPLIT</span>
          <span class="history-profit ${profit >= 0 ? 'win' : 'loss'}">
            ${profit >= 0 ? '+' : ''}${profit.toFixed(2)} üçã
          </span>
        </div>
        <div class="history-hands">
          Hand 1: ${playerValue} (${hand0Result}) | Hand 2: ${splitValue} (${hand1Result}) | Dealer: ${dealerValue}
        </div>
        ${sideBetHtml}
      `;

      historyList.insertBefore(item, historyList.firstChild);

      while (historyList.children.length > 20) {
        historyList.removeChild(historyList.lastChild);
      }
    }

    // End game
    function endGame(result, profit) {
      gameInProgress = false;
      playerTurn = false;
      renderHands(true);

      // Calculate actual profit (including returned bet)
      if (result === 'win' || result === 'blackjack') {
        balance += currentBet + profit + currentBet; // Return bet + winnings
      } else if (result === 'push') {
        balance += currentBet; // Return bet
      }
      
      totalProfit += profit;
      
      // Update stats
      stats.hands++;
      if (result === 'win' || result === 'blackjack') {
        stats.wins++;
      } else if (result === 'lose') {
        stats.losses++;
      }
      if (result === 'blackjack') {
        stats.blackjacks++;
      }

      updateBalance();
      updateStats();
      updateProfit();
      showResult(result, profit);
      addToHistory(result, profit);
      updateButtons();
    }

    // Show result message
    function showResult(result, profit) {
      const messageEl = document.getElementById('gameMessage');
      const resultBox = document.getElementById('lastResult');
      const resultValue = document.getElementById('lastResultValue');

      let message = '';
      let className = 'game-message ';

      switch (result) {
        case 'win':
          message = `WIN! +${profit.toFixed(2)} üçã`;
          className += 'win';
          break;
        case 'lose':
          message = `LOSE ${profit.toFixed(2)} üçã`;
          className += 'lose';
          break;
        case 'push':
          message = 'PUSH - Bet Returned';
          className += 'push';
          break;
        case 'blackjack':
          message = `BLACKJACK! +${profit.toFixed(2)} üçã`;
          className += 'blackjack';
          break;
      }

      messageEl.textContent = message;
      messageEl.className = className;
      messageEl.style.display = 'block';

      // Update last result box
      resultBox.style.display = 'block';
      resultBox.className = result === 'push' ? 'result-box push' : (profit >= 0 ? 'result-box win' : 'result-box loss');
      resultValue.className = result === 'push' ? 'result-value push' : (profit >= 0 ? 'result-value win' : 'result-value loss');
      resultValue.textContent = `${profit >= 0 ? '+' : ''}${profit.toFixed(2)} üçã`;
    }

    // Add to history
    function addToHistory(result, profit) {
      const playerValue = calculateHand(playerHand);
      const dealerValue = calculateHand(dealerHand);
      
      // Include side bet results in total
      let totalProfit = profit;
      let sideBetInfo = '';
      
      if (sideBetResults.length > 0) {
        sideBetResults.forEach(sb => {
          if (sb.profit > 0) {
            sideBetInfo += ` | ${sb.name}: +${sb.profit}`;
          }
        });
      }
      
      history.unshift({
        id: gameIdCounter++,
        result,
        profit,
        playerValue,
        dealerValue,
        bet: currentBet,
        sideBets: [...sideBetResults]
      });

      if (history.length > 20) history.pop();

      const historyList = document.getElementById('historyList');
      
      if (history.length === 1) {
        historyList.innerHTML = '';
      }

      const item = document.createElement('div');
      item.className = 'history-item';
      
      let resultClass = result;
      let resultText = result.toUpperCase();
      if (result === 'blackjack') {
        resultText = 'BLACKJACK';
      }

      // Calculate total profit including side bets for this hand
      let displayProfit = profit;
      sideBetResults.forEach(sb => {
        displayProfit += sb.profit;
      });

      let sideBetHtml = '';
      if (sideBetResults.length > 0) {
        sideBetHtml = '<div class="history-sidebets">';
        sideBetResults.forEach(sb => {
          const sbClass = sb.profit > 0 ? 'win' : 'lose';
          sideBetHtml += `<span class="history-sidebet ${sbClass}">${sb.name}: ${sb.profit > 0 ? '+' : ''}${sb.profit.toFixed(0)}</span>`;
        });
        sideBetHtml += '</div>';
      }

      item.innerHTML = `
        <div class="history-item-header">
          <span class="history-result ${resultClass}">${resultText}</span>
          <span class="history-profit ${displayProfit >= 0 ? 'win' : 'loss'}">
            ${displayProfit >= 0 ? '+' : ''}${displayProfit.toFixed(2)} üçã
          </span>
        </div>
        <div class="history-hands">
          Player: ${playerValue} vs Dealer: ${dealerValue}
        </div>
        ${sideBetHtml}
      `;

      historyList.insertBefore(item, historyList.firstChild);

      while (historyList.children.length > 20) {
        historyList.removeChild(historyList.lastChild);
      }
    }

    // Update buttons
    function updateButtons() {
      const dealBtn = document.getElementById('dealBtn');
      const hitBtn = document.getElementById('hitBtn');
      const standBtn = document.getElementById('standBtn');
      const doubleBtn = document.getElementById('doubleBtn');
      const splitBtn = document.getElementById('splitBtn');
      const betInput = document.getElementById('betInput');
      const betBtns = ['betHalf', 'betDouble', 'betMax'];

      if (gameInProgress) {
        dealBtn.disabled = true;
        hitBtn.disabled = !playerTurn;
        standBtn.disabled = !playerTurn;
        
        // Double is available on first two cards of current hand
        const currentHand = currentHandIndex === 0 ? playerHand : splitHand;
        const currentHandBet = handBets[currentHandIndex];
        doubleBtn.disabled = !playerTurn || currentHand.length !== 2 || balance < currentHandBet;
        
        // Split is available only on initial hand with matching ranks
        const canSplit = !hasSplit && 
                         playerHand.length === 2 && 
                         playerHand[0].rank === playerHand[1].rank &&
                         balance >= betAmount;
        splitBtn.disabled = !playerTurn || !canSplit;
        
        betInput.disabled = true;
        betBtns.forEach(id => document.getElementById(id).disabled = true);
        updateSideBetControls(true);
      } else {
        dealBtn.disabled = balance < betAmount;
        hitBtn.disabled = true;
        standBtn.disabled = true;
        doubleBtn.disabled = true;
        splitBtn.disabled = true;
        betInput.disabled = false;
        betBtns.forEach(id => document.getElementById(id).disabled = false);
        updateSideBetControls(false);
      }
    }

    // Disable all action buttons
    function disableAllActions() {
      document.getElementById('hitBtn').disabled = true;
      document.getElementById('standBtn').disabled = true;
      document.getElementById('doubleBtn').disabled = true;
      document.getElementById('splitBtn').disabled = true;
    }

    // Update balance display
    function updateBalance() {
      document.getElementById('balanceValue').textContent = balance.toFixed(2);
    }

    // Update bet badge
    function updateBetBadge() {
      document.getElementById('currentBetBadge').textContent = `${currentBet} üçã Bet`;
    }

    // Update stats
    function updateStats() {
      document.getElementById('statHands').textContent = stats.hands;
      document.getElementById('statWins').textContent = stats.wins;
      document.getElementById('statLosses').textContent = stats.losses;
      document.getElementById('statBlackjacks').textContent = stats.blackjacks;
    }

    // Update profit display
    function updateProfit() {
      const profitEl = document.getElementById('profitValue');
      profitEl.textContent = `${totalProfit >= 0 ? '+' : ''}${totalProfit.toFixed(2)} üçã`;
      profitEl.className = totalProfit >= 0 ? 'result-value win' : 'result-value loss';
    }

    // Helper functions
    function adjustBet(multiplier) {
      if (gameInProgress) return;
      betAmount = Math.max(1, Math.min(balance, Math.floor(betAmount * multiplier)));
      document.getElementById('betInput').value = betAmount;
      updateBetBadge();
      updateButtons();
    }

    function setBetMax() {
      if (gameInProgress) return;
      betAmount = Math.floor(balance);
      document.getElementById('betInput').value = betAmount;
      updateBetBadge();
      updateButtons();
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Toggle side bet
    function toggleSideBet(betType) {
      if (gameInProgress) return;
      
      const checkbox = document.getElementById(`${betType}Check`);
      const input = document.getElementById(`${betType}Bet`);
      const row = checkbox.closest('.side-bet-row');
      
      sideBets[betType].enabled = checkbox.checked;
      
      if (input) {
        input.disabled = !checkbox.checked;
      }
      
      if (checkbox.checked) {
        row.classList.add('active');
      } else {
        row.classList.remove('active');
      }
      
      updateButtons();
    }

    // Get card rank value for straights (A=1 or 14)
    function getRankValue(rank) {
      const values = { 'A': 14, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 11, 'Q': 12, 'K': 13 };
      return values[rank];
    }

    // Check if three cards form a straight
    function isStraight(cards) {
      const values = cards.map(c => getRankValue(c.rank)).sort((a, b) => a - b);
      // Check normal straight
      if (values[2] - values[1] === 1 && values[1] - values[0] === 1) return true;
      // Check A-2-3 straight
      if (values[0] === 2 && values[1] === 3 && values[2] === 14) return true;
      // Check Q-K-A straight
      if (values[0] === 12 && values[1] === 13 && values[2] === 14) return true;
      return false;
    }

    // Evaluate Perfect Pairs side bet
    function evaluatePerfectPairs() {
      if (!sideBets.perfectPairs.enabled) return null;
      
      const card1 = playerHand[0];
      const card2 = playerHand[1];
      const betAmt = parseInt(document.getElementById('perfectPairsBet').value) || 5;
      
      if (card1.rank !== card2.rank) {
        return { name: 'Perfect Pairs', result: 'No Pair', payout: 0, bet: betAmt, profit: -betAmt };
      }
      
      // Same rank - check type of pair
      if (card1.suit === card2.suit) {
        // Perfect pair (same suit)
        const win = betAmt * PERFECT_PAIRS_PAYOUTS.perfectPair;
        return { name: 'Perfect Pairs', result: 'Perfect Pair!', payout: PERFECT_PAIRS_PAYOUTS.perfectPair, bet: betAmt, profit: win };
      }
      
      const isRed1 = card1.suit === '‚ô•' || card1.suit === '‚ô¶';
      const isRed2 = card2.suit === '‚ô•' || card2.suit === '‚ô¶';
      
      if (isRed1 === isRed2) {
        // Colored pair (same color)
        const win = betAmt * PERFECT_PAIRS_PAYOUTS.coloredPair;
        return { name: 'Perfect Pairs', result: 'Colored Pair!', payout: PERFECT_PAIRS_PAYOUTS.coloredPair, bet: betAmt, profit: win };
      }
      
      // Mixed pair (different color)
      const win = betAmt * PERFECT_PAIRS_PAYOUTS.mixedPair;
      return { name: 'Perfect Pairs', result: 'Mixed Pair!', payout: PERFECT_PAIRS_PAYOUTS.mixedPair, bet: betAmt, profit: win };
    }

    // Evaluate 21+3 side bet
    function evaluateTwentyOnePlus3() {
      if (!sideBets.twentyOne.enabled) return null;
      
      const cards = [playerHand[0], playerHand[1], dealerHand[0]];
      const betAmt = parseInt(document.getElementById('twentyOneBet').value) || 5;
      
      const suits = cards.map(c => c.suit);
      const ranks = cards.map(c => c.rank);
      
      const allSameSuit = suits[0] === suits[1] && suits[1] === suits[2];
      const allSameRank = ranks[0] === ranks[1] && ranks[1] === ranks[2];
      const straight = isStraight(cards);
      
      // Suited trips (three of a kind, same suit)
      if (allSameRank && allSameSuit) {
        const win = betAmt * TWENTY_ONE_PAYOUTS.suitedTrips;
        return { name: '21+3', result: 'Suited Trips!', payout: TWENTY_ONE_PAYOUTS.suitedTrips, bet: betAmt, profit: win };
      }
      
      // Straight flush
      if (straight && allSameSuit) {
        const win = betAmt * TWENTY_ONE_PAYOUTS.straightFlush;
        return { name: '21+3', result: 'Straight Flush!', payout: TWENTY_ONE_PAYOUTS.straightFlush, bet: betAmt, profit: win };
      }
      
      // Three of a kind
      if (allSameRank) {
        const win = betAmt * TWENTY_ONE_PAYOUTS.threeOfKind;
        return { name: '21+3', result: 'Three of a Kind!', payout: TWENTY_ONE_PAYOUTS.threeOfKind, bet: betAmt, profit: win };
      }
      
      // Straight
      if (straight) {
        const win = betAmt * TWENTY_ONE_PAYOUTS.straight;
        return { name: '21+3', result: 'Straight!', payout: TWENTY_ONE_PAYOUTS.straight, bet: betAmt, profit: win };
      }
      
      // Flush
      if (allSameSuit) {
        const win = betAmt * TWENTY_ONE_PAYOUTS.flush;
        return { name: '21+3', result: 'Flush!', payout: TWENTY_ONE_PAYOUTS.flush, bet: betAmt, profit: win };
      }
      
      return { name: '21+3', result: 'No Hand', payout: 0, bet: betAmt, profit: -betAmt };
    }

    // Process side bets
    function processSideBets() {
      sideBetResults = [];
      let totalSideBetCost = 0;
      
      // Deduct side bet amounts
      if (sideBets.perfectPairs.enabled) {
        const amt = parseInt(document.getElementById('perfectPairsBet').value) || 5;
        totalSideBetCost += amt;
      }
      if (sideBets.twentyOne.enabled) {
        const amt = parseInt(document.getElementById('twentyOneBet').value) || 5;
        totalSideBetCost += amt;
      }
      
      balance -= totalSideBetCost;
      updateBalance();
      
      // Evaluate side bets
      const ppResult = evaluatePerfectPairs();
      if (ppResult) sideBetResults.push(ppResult);
      
      const t21Result = evaluateTwentyOnePlus3();
      if (t21Result) sideBetResults.push(t21Result);
      
      // Apply winnings immediately for side bets
      sideBetResults.forEach(result => {
        if (result.profit > 0) {
          balance += result.profit + result.bet; // Return bet + winnings
          totalProfit += result.profit;
        } else {
          totalProfit += result.profit;
        }
      });
      
      updateBalance();
      updateProfit();
      displaySideBetResults();
    }

    // Display side bet results
    function displaySideBetResults() {
      if (sideBetResults.length === 0) {
        document.getElementById('sideBetResult').style.display = 'none';
        return;
      }
      
      const container = document.getElementById('sideBetResult');
      let html = '';
      
      sideBetResults.forEach(result => {
        const isWin = result.profit > 0;
        html += `
          <div class="side-bet-result-item">
            <span class="side-bet-result-name">${result.name}: ${result.result}</span>
            <span class="side-bet-result-value ${isWin ? 'win' : 'lose'}">
              ${isWin ? '+' : ''}${result.profit.toFixed(2)} üçã
            </span>
          </div>
        `;
      });
      
      container.innerHTML = html;
      container.style.display = 'block';
    }

    // Update side bet controls state
    function updateSideBetControls(disabled) {
      ['perfectPairsCheck', 'twentyOneCheck', 'insuranceAutoCheck'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.disabled = disabled;
      });
      
      ['perfectPairsBet', 'twentyOneBet'].forEach(id => {
        const el = document.getElementById(id);
        const checkId = id.replace('Bet', 'Check');
        const checkbox = document.getElementById(checkId);
        if (el && checkbox) {
          el.disabled = disabled || !checkbox.checked;
        }
      });
    }

    // Event listeners
    document.getElementById('betInput').addEventListener('change', function() {
      if (gameInProgress) return;
      betAmount = Math.max(1, Math.min(balance, parseInt(this.value) || 1));
      this.value = betAmount;
      document.getElementById('currentBetBadge').textContent = `${betAmount} üçã Bet`;
      updateButtons();
    });

    // Initialize
    createDeck();
    updateBalance();
    updateButtons();
    updateBetBadge();
  </script>
</body>
</html>
